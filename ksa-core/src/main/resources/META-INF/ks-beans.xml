<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans-3.0.xsd"
       default-lazy-init="true">

    <bean id="ksEntityManager" class="org.springframework.orm.jpa.support.SharedEntityManagerBean">
        <property name="persistenceUnitName" value="ks"/>
    </bean>

    <!-- Atp Service Config -->
    <bean id="atpService" class="com.sigmasys.kuali.ksa.service.atp.AtpServiceDecorator">
        <property name="atpDao" ref="atpEnrDao"/>
        <property name="atpRelDao" ref="atpAtpRelationDao"/>
        <!-- <property name="atpRelTypeDao" ref="atpAtpRelationTypeDao"/> -->
        <property name="milestoneDao" ref="milestoneDao"/>
        <!-- <property name="milestoneTypeDao" ref="milestoneTypeDao"/> -->
        <property name="atpMilestoneRelationDao" ref="atpMilestoneRelationDao"/>
        <!-- <property name="atpMilestoneRelationTypeDao" ref="atpMilestoneRelationTypeDao"/> -->
        <property name="atpCriteriaLookupService">
            <bean parent="criteriaLookupService">
                <property name="predicateTransforms">
                    <list merge="false">
                        <bean parent="keyword2LikeTransform">
                            <property name="likeAttributes">
                                <set merge="true">
                                    <value>code</value>
                                    <value>typeKey</value>
                                    <value>stateKey</value>
                                </set>
                            </property>
                        </bean>
                        <bean class="org.kuali.student.r2.common.criteria.transform.RenameTransform">
                            <property name="renameAttributes">
                                <map>
                                    <entry key="descr.plain" value="plain"/>
                                    <entry key="descr.formatted" value="formatted"/>
                                    <entry key="code" value="atpCode"/>
                                    <entry key="typeKey" value="atpType"/>
                                    <entry key="stateKey" value="atpState"/>
                                </map>
                            </property>
                        </bean>
                        <ref bean="metaTransform"/>
                        <ref bean="attributeTransform"/>
                    </list>
                </property>
            </bean>
        </property>
        <property name="atpAtpRelationCriteriaLookupService">
            <bean parent="relationCriteriaLookupService">
                <property name="predicateTransforms">
                    <list merge="false">
                        <bean parent="keyword2LikeTransform">
                            <property name="likeAttributes">
                                <set merge="false">
                                    <value>typeKey</value>
                                    <value>stateKey</value>
                                </set>
                            </property>
                        </bean>
                        <bean class="org.kuali.student.r2.common.criteria.transform.RenameTransform">
                            <property name="renameAttributes">
                                <map>
                                    <entry key="atpId" value="atp.id"/>
                                    <entry key="relatedAtpId" value="relatedAtp.id"/>
                                    <entry key="typeKey" value="atpType"/>
                                    <entry key="stateKey" value="atpState"/>
                                </map>
                            </property>
                        </bean>
                        <ref bean="metaTransform"/>
                        <ref bean="attributeTransform"/>
                    </list>
                </property>
            </bean>
        </property>
        <property name="milestoneCriteriaLookupService">
            <bean parent="criteriaLookupService">
                <property name="predicateTransforms">
                    <list merge="false">
                        <bean parent="keyword2LikeTransform">
                            <property name="likeAttributes">
                                <set merge="true">
                                    <value>typeKey</value>
                                    <value>stateKey</value>
                                </set>
                            </property>
                        </bean>
                        <bean class="org.kuali.student.r2.common.criteria.transform.RenameTransform">
                            <property name="renameAttributes">
                                <map>
                                    <entry key="typeKey" value="atpType"/>
                                    <entry key="stateKey" value="atpState"/>
                                    <entry key="isAllDay" value="allDay"/>
                                    <entry key="isRelative" value="relative"/>
                                    <entry key="isDateRange" value="dateRange"/>
                                </map>
                            </property>
                        </bean>
                        <ref bean="descrTransform"/>
                        <ref bean="metaTransform"/>
                        <ref bean="attributeTransform"/>
                    </list>
                </property>
            </bean>
        </property>
        <property name="searchManager" ref="atpSearchManager"/>
    </bean>

    <bean id="atpSearchManager" class="org.kuali.student.r2.common.class1.search.SearchManagerImpl">
        <constructor-arg index="0" value="classpath:atp-search-config.xml"/>
        <property name="dao" ref="enrollSearchableDao"/>
    </bean>

    <bean id="enrollSearchableDao" class="org.kuali.student.r2.common.dao.impl.SearchableCrudDaoImpl">
        <property name="em" ref="ksEntityManager"/>
    </bean>

    <bean id="atpEnrDao" class="org.kuali.student.r2.core.class1.atp.dao.AtpDao">
        <property name="em" ref="ksEntityManager"/>
    </bean>

    <bean id="atpAtpRelationDao" class="org.kuali.student.r2.core.class1.atp.dao.AtpAtpRelationDao">
        <property name="em" ref="ksEntityManager"/>
    </bean>

    <!--
        <bean id="atpAtpRelationTypeDao" class="org.kuali.student.r2.core.class1.atp.dao.AtpAtpRelationTypeDao">
            <property name="em" ref="enrollEntityManager"/>
        </bean>
    -->

    <bean id="milestoneDao" class="org.kuali.student.r2.core.class1.atp.dao.MilestoneDao">
        <property name="em" ref="ksEntityManager"/>
    </bean>

    <!--
        <bean id="milestoneTypeDao" class="org.kuali.student.r2.core.class1.atp.dao.MilestoneTypeDao">
            <property name="em" ref="enrollEntityManager"/>
        </bean>
    -->
    <bean id="atpMilestoneRelationDao" class="org.kuali.student.r2.core.class1.atp.dao.AtpMilestoneRelationDao">
        <property name="em" ref="ksEntityManager"/>
    </bean>

    <bean id="criteriaLookupDaoJpa" class="org.kuali.student.r2.common.criteria.impl.CriteriaLookupDaoJpaImpl">
        <property name="entityManager" ref="ksEntityManager"/>
    </bean>

    <bean id="attributeTransform" class="org.kuali.student.r2.common.criteria.transform.AttributeTransform"/>

    <bean id="key2IdTransform" class="org.kuali.student.r2.common.criteria.transform.RenameTransform">
        <property name="renameAttributes">
            <map>
                <entry key="key" value="id"/>
            </map>
        </property>
    </bean>

    <bean id="descrTransform" class="org.kuali.student.r2.common.criteria.transform.RenameTransform">
        <property name="renameAttributes">
            <map>
                <entry key="descr.plain" value="descrPlain"/>
                <entry key="descr.formatted" value="descrFormatted"/>
            </map>
        </property>
    </bean>

    <bean id="metaTransform" class="org.kuali.student.r2.common.criteria.transform.RenameTransform">
        <property name="renameAttributes">
            <map>
                <entry key="meta.createId" value="createId"/>
                <entry key="meta.createTime" value="createTime"/>
                <entry key="meta.updateId" value="createId"/>
                <entry key="meta.updateTime" value="updateTime"/>
                <entry key="meta.versionInd" value="versionInd"/>
            </map>
        </property>
    </bean>

    <bean id="keyword2LikeTransform" class="org.kuali.student.r2.common.criteria.transform.Keyword2LikeTransform">
        <property name="keywordAttribute" value="keywordSearch"/>
        <property name="likeAttributes">
            <set>
                <value>name</value>
                <value>descr.plain</value>
                <value>descr.formatted</value>
            </set>
        </property>
    </bean>

    <bean id="criteriaLookupService" class="org.kuali.student.r2.common.criteria.impl.CriteriaLookupServiceImpl">
        <property name="criteriaLookupDao" ref="criteriaLookupDaoJpa"/>
        <property name="predicateTransforms">
            <list>
                <ref bean="keyword2LikeTransform"/>
                <ref bean="descrTransform"/>
                <ref bean="metaTransform"/>
                <ref bean="attributeTransform"/>
            </list>
        </property>
    </bean>

    <bean id="relationCriteriaLookupService"
          class="org.kuali.student.r2.common.criteria.impl.CriteriaLookupServiceImpl">
        <property name="criteriaLookupDao" ref="criteriaLookupDaoJpa"/>
        <property name="predicateTransforms">
            <list>
                <ref bean="metaTransform"/>
                <ref bean="attributeTransform"/>
            </list>
        </property>
    </bean>

    <!-- /////////////////////////////////// HOLD Service Configuration /////////////////////////////////////////// -->

    <!-- Hold Service -->
    <bean id="holdService" class="com.sigmasys.kuali.ksa.service.hold.HoldServiceDecorator">
        <property name="holdIssueDao" ref="holdIssueDao"/>
        <property name="appliedHoldDao" ref="appliedHoldDao"/>
        <property name="criteriaLookupService" ref="criteriaLookupService"/>
    </bean>

    <bean id="appliedHoldDao" class="org.kuali.student.enrollment.class1.hold.dao.AppliedHoldDao">
        <property name="em" ref="ksEntityManager"/>
    </bean>

    <bean id="holdIssueDao" class="org.kuali.student.enrollment.class1.hold.dao.HoldIssueDao">
        <property name="em" ref="ksEntityManager"/>
    </bean>


</beans>
