<?xml version="1.0" encoding="UTF-8"?>
<!--

    Copyright 2010 The Kuali Foundation Licensed under the
    Educational Community License, Version 2.0 (the "License"); you may
    not use this file except in compliance with the License. You may
    obtain a copy of the License at

    http://www.osedu.org/licenses/ECL-2.0

    Unless required by applicable law or agreed to in writing,
    software distributed under the License is distributed on an "AS IS"
    BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
    or implied. See the License for the specific language governing
    permissions and limitations under the License.

-->


<!--
    TODO: ################################ currentTerm override ################################
    To work around multiple versions of courses spanning terms we override currentTerm to be lastScheduledTerm.
    Once version compatibility is added we should switch back to using versionIndependentId and currentTerm for lastATP
-->


<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:search="http://student.kuali.org/xsd/search-extension"
       xsi:schemaLocation="http://student.kuali.org/xsd/search-extension http://student.kuali.org/xsd/search-extension/search-extension.xsd

	http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd">

    <import resource="classpath:lu-search-config.xml"/>
    <search:searchType id="ksap.course.info">
        <search:searchResultTypeInfo>
            <search:name/>
            <search:desc/>
            <search:resultColumns>
                <search:resultColumn id="course.id">
                    <search:dataType>string</search:dataType>
                </search:resultColumn>
                <search:resultColumn id="course.name">
                    <search:dataType>string</search:dataType>
                </search:resultColumn>
                <search:resultColumn id="course.number">
                    <search:dataType>string</search:dataType>
                </search:resultColumn>
                <search:resultColumn id="course.subject">
                    <search:dataType>string</search:dataType>
                </search:resultColumn>
                <search:resultColumn id="course.level">
                    <search:dataType>string</search:dataType>
                </search:resultColumn>
                <search:resultColumn id="course.credits">
                    <search:dataType>string</search:dataType>
                </search:resultColumn>
                <search:resultColumn id="course.code">
                    <search:dataType>string</search:dataType>
                </search:resultColumn>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="ksap.course.info.atp">
        <search:searchResultTypeInfo>
            <search:name/>
            <search:desc/>
            <search:resultColumns>
                <search:resultColumn id="course.key">
                    <search:dataType>string</search:dataType>
                </search:resultColumn>
                <search:resultColumn id="atp.id">
                    <search:dataType>string</search:dataType>
                </search:resultColumn>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="ksap.course.info.gened">
        <search:searchResultTypeInfo>
            <search:name/>
            <search:desc/>
            <search:resultColumns>
                <search:resultColumn id="course.owner">
                    <search:dataType>string</search:dataType>
                </search:resultColumn>
                <search:resultColumn id="gened.name">
                    <search:dataType>string</search:dataType>
                </search:resultColumn>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="ksap.course.info.credits.details">
        <search:searchResultTypeInfo>
            <search:name/>
            <search:desc/>
            <search:resultColumns>
                <search:resultColumn id="credit.id">
                    <search:dataType>string</search:dataType>
                </search:resultColumn>
                <search:resultColumn id="credit.type">
                    <search:dataType>string</search:dataType>
                </search:resultColumn>
                <search:resultColumn id="credit.min">
                    <search:dataType>string</search:dataType>
                </search:resultColumn>
                <search:resultColumn id="credit.max">
                    <search:dataType>string</search:dataType>
                </search:resultColumn>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="ksap.distinct.clu.divisions">
        <search:searchResultTypeInfo>
            <search:name/>
            <search:desc/>
            <search:resultColumns>
                <search:resultColumn id="division">
                    <search:dataType>string</search:dataType>
                </search:resultColumn>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="ksap.clu.divisionAndCode">
        <search:searchResultTypeInfo>
            <search:name/>
            <search:desc/>
            <search:resultColumns>
                <search:resultColumn id="courseCode">
                    <search:dataType>string</search:dataType>
                </search:resultColumn>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="ksap.clu.division">
        <search:searchResultTypeInfo>
            <search:name/>
            <search:desc/>
            <search:resultColumns>
                <ref bean="courseCode"/>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="ksap.lu.search.fulltext">
        <search:searchResultTypeInfo>
            <search:name/>
            <search:desc/>
            <search:resultColumns>
                <ref bean="lu.resultColumn.cluId"/>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="ksap.course.version.id">
        <search:searchResultTypeInfo>
            <search:name/>
            <search:desc/>
            <search:resultColumns>
                <ref bean="lu.resultColumn.cluId"/>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="ksap.lu.search.title">
        <search:searchResultTypeInfo>
            <search:name/>
            <search:desc/>
            <search:resultColumns>
                <ref bean="lu.resultColumn.cluId"/>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="ksap.lu.search.description">
        <search:searchResultTypeInfo>
            <search:name/>
            <search:desc/>
            <search:resultColumns>
                <ref bean="lu.resultColumn.cluId"/>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="ksap.lu.search.divisionAndFulltext">
        <search:searchResultTypeInfo>
            <search:name/>
            <search:desc/>
            <search:resultColumns>
                <ref bean="lu.resultColumn.cluId"/>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="ksap.lu.search.divisionAndCode">
        <search:searchResultTypeInfo>
            <search:name/>
            <search:desc/>
            <search:resultColumns>
                <ref bean="lu.resultColumn.cluId"/>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="ksap.lu.search.divisionAndLevel">
        <search:searchResultTypeInfo>
            <search:name/>
            <search:desc/>
            <search:resultColumns>
                <ref bean="lu.resultColumn.cluId"/>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="ksap.lu.search.division">
        <search:searchResultTypeInfo>
            <search:name/>
            <search:desc/>
            <search:resultColumns>
                <ref bean="lu.resultColumn.cluId"/>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="ksap.lu.search.additionalDivision">
        <search:searchResultTypeInfo>
            <search:name/>
            <search:desc/>
            <search:resultColumns>
                <ref bean="lu.resultColumn.cluId"/>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="ksap.course.getcluid">
        <search:searchResultTypeInfo>
            <search:name/>
            <search:desc/>
            <search:resultColumns>
                <ref bean="lu.resultColumn.cluId"/>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="ksap.course.getCourseTitleAndId">
        <search:searchResultTypeInfo>
            <search:name/>
            <search:desc/>
            <search:resultColumns>
                <ref bean="lu.resultColumn.cluId"/>
                <search:resultColumn id="id.lngName">
                    <search:dataType>string</search:dataType>
                </search:resultColumn>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="ksap.course.prereqsearch.subject">
        <search:searchResultTypeInfo>
            <search:name/>
            <search:desc/>
            <search:resultColumns>
                <ref bean="lu.resultColumn.cluId"/>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="ksap.course.prereqsearch.range">
        <search:searchResultTypeInfo>
            <search:name/>
            <search:desc/>
            <search:resultColumns>
                <ref bean="lu.resultColumn.cluId"/>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <search:searchType id="ksap.course.prereqsearch.exclusions">
        <search:searchResultTypeInfo>
            <search:name/>
            <search:desc/>
            <search:resultColumns>
                <ref bean="lu.resultColumn.cluId"/>
                <ref bean="lu.resultColumn.luOptionalCode"/>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>

    <!--<search:searchType id="ksap.course.getCampusLocations">
        <search:searchResultTypeInfo>
            <search:name/>
            <search:desc/>
            <search:resultColumns>
                <search:resultColumn id="lu.resultColumn.campusVal">
                    <search:dataType>string</search:dataType>
                </search:resultColumn>
            </search:resultColumns>
        </search:searchResultTypeInfo>
        <search:searchCriteriaTypeInfo>
            <search:queryParams>
            </search:queryParams>
        </search:searchCriteriaTypeInfo>
    </search:searchType>-->

    <bean id="queryMap" parent="queryMap-parent">
        <property name="sourceMap">
            <map merge="true">

                <entry key="ksap.distinct.clu.divisions">
                    <value>
                        SELECT
                        distinct( ident.division )
                        FROM CluIdentifier ident
                        WHERE ident.division IS NOT null
                    </value>
                </entry>

                <entry key="ksap.lu.search.title">
                    <value>
                        SELECT
                        clu.id
                        FROM CluAttribute attr
                        JOIN attr.owner clu
                        JOIN clu.officialIdentifier ident
                        JOIN clu.descr cludesc
                        WHERE
                        (
                        UPPER( ' ' || ident.longName || ' ' ) LIKE '% '||:queryText||'%'
                        )
                       <!-- AND
                        attr.name = 'course.campus'
                        AND
                        attr.value IN :campuses-->
                        AND clu.id NOT IN (SELECT att.owner FROM CluAttribute att where
                        att.name='course.catalogOmit_ind' and att.value='Y')
                        AND clu.expectedFirstAtp = (select min(c.expectedFirstAtp) FROM Clu c where c.version.versionIndId = clu.version.versionIndId and c.lastAtp &lt;= :lastScheduledTerm group by c.version.versionIndId )
                        ORDER BY ident.code
                    </value>
                </entry>
                <entry key="ksap.lu.search.description">
                    <value>
                        SELECT
                        clu.id
                        FROM CluAttribute attr
                        JOIN attr.owner clu
                        JOIN clu.officialIdentifier ident
                        JOIN clu.descr cludesc
                        WHERE
                        (
                        UPPER( ' ' || cludesc.plain || ' ' ) LIKE '% '||:queryText||'%'
                        )
                        <!--AND-->
                        <!--attr.name = 'course.campus'-->
                        <!--AND-->
                        <!--attr.value IN :campuses-->
                        AND clu.id NOT IN (SELECT att.owner FROM CluAttribute att where
                        att.name='course.catalogOmit_ind' and att.value='Y')
                        AND clu.expectedFirstAtp = (select min(c.expectedFirstAtp) FROM Clu c where c.version.versionIndId = clu.version.versionIndId and c.lastAtp &lt;= :lastScheduledTerm group by c.version.versionIndId )
                        ORDER BY ident.code
                    </value>
                </entry>

                <entry key="ksap.lu.search.fulltext">
                    <value>
                        SELECT
                        clu.id
                        FROM CluAttribute attr
                        JOIN attr.owner clu
                        JOIN clu.officialIdentifier ident
                        JOIN clu.descr cludesc
                        WHERE
                        (
                        UPPER( ' ' || ident.longName || ' ' ) LIKE '% '||:queryText||'%'
                        OR
                        UPPER( ' ' || cludesc.plain || ' ' ) LIKE '% '||:queryText||'%'
                        )
                        <!--AND-->
                        <!--attr.name = 'course.campus'-->
                        <!--AND-->
                        <!--attr.value IN :campuses-->
                        AND clu.id NOT IN (SELECT att.owner FROM CluAttribute att where
                        att.name='course.catalogOmit_ind' and att.value='Y')
                        AND clu.expectedFirstAtp = (select min(c.expectedFirstAtp) FROM Clu c where c.version.versionIndId = clu.version.versionIndId and c.lastAtp &lt;= :lastScheduledTerm group by c.version.versionIndId )
                    </value>
                </entry>

                <entry key="ksap.lu.search.divisionAndCode">
                    <value>
                        SELECT
                        clu.id
                        FROM CluAttribute attr
                        JOIN attr.owner clu
                        JOIN clu.officialIdentifier ident
                        WHERE
                        ident.division = :division
                        AND
                        ident.suffixCode = :code
                        <!--AND-->
                        <!--attr.name = 'course.campus'-->
                        <!--AND-->
                        <!--attr.value IN :campuses-->
                        AND clu.id NOT IN (SELECT att.owner FROM CluAttribute att where
                        att.name='course.catalogOmit_ind' and att.value='Y')
                        AND clu.expectedFirstAtp = (select min(c.expectedFirstAtp) FROM Clu c where c.version.versionIndId = clu.version.versionIndId and c.lastAtp &lt;= :lastScheduledTerm group by c.version.versionIndId )
                        ORDER BY ident.suffixCode
                    </value>
                </entry>

                <entry key="ksap.lu.search.divisionAndLevel">
                    <value>
                        SELECT
                        clu.id
                        FROM CluAttribute attr
                        JOIN attr.owner clu
                        JOIN clu.officialIdentifier ident
                        WHERE
                        ident.division = :division
                        AND
                        ident.level = :level
                        <!--AND-->
                        <!--attr.name = 'course.campus'-->
                        <!--AND-->
                        <!--attr.value IN :campuses-->
                        AND clu.id NOT IN (SELECT att.owner FROM CluAttribute att where
                        att.name='course.catalogOmit_ind' and att.value='Y')
                        AND clu.expectedFirstAtp = (select min(c.expectedFirstAtp) FROM Clu c where c.version.versionIndId = clu.version.versionIndId and c.lastAtp &lt;= :lastScheduledTerm group by c.version.versionIndId )
                        ORDER BY ident.suffixCode
                    </value>
                </entry>
                <entry key="ksap.lu.search.additionalDivision">
                    <value>
                        SELECT
                        clu.id
                        FROM CluAttribute attr
                        JOIN attr.owner clu
                        JOIN clu.officialIdentifier ident
                        WHERE
                        ident.division IN (:divisions)
                        <!--AND-->
                        <!--attr.name = 'course.campus'-->
                        <!--AND-->
                        <!--attr.value IN :campuses-->
                        AND clu.id NOT IN (SELECT att.owner FROM CluAttribute att where
                        att.name='course.catalogOmit_ind' and att.value='Y')
                        AND clu.expectedFirstAtp = (select min(c.expectedFirstAtp) FROM Clu c where c.version.versionIndId = clu.version.versionIndId and c.lastAtp &lt;= :lastScheduledTerm group by c.version.versionIndId )
                        ORDER BY ident.suffixCode
                    </value>
                </entry>
                <entry key="ksap.lu.search.division">
                    <value>
                        SELECT
                        clu.id
                        FROM CluAttribute attr
                        JOIN attr.owner clu
                        JOIN clu.officialIdentifier ident
                        WHERE
                        ident.division = :division
                        <!--AND-->
                        <!--attr.name = 'course.campus'-->
                        <!--AND-->
                        <!--attr.value IN :campuses-->
                        AND clu.id NOT IN (SELECT att.owner FROM CluAttribute att where
                        att.name='course.catalogOmit_ind' and att.value='Y')
                        AND clu.expectedFirstAtp = (select min(c.expectedFirstAtp) FROM Clu c where c.version.versionIndId = clu.version.versionIndId and c.lastAtp &lt;= :lastScheduledTerm group by c.version.versionIndId )
                        ORDER BY ident.suffixCode
                    </value>
                </entry>
                <!--<entry key="ksap.course.info">-->
                    <!--<value>NATIVE:-->
                        <!--SELECT-->
                        <!--ident.LNG_NAME,-->
                        <!--trim( ident.SUFX_CD ),-->
                        <!--trim( ident.DIVISION ),-->
                        <!--trim( ident.LVL ),-->
                        <!--opt.RES_COMP_ID,-->
                        <!--ident.cd-->
                        <!--FROM-->
                        <!--KSLU_CLU clu,-->
                        <!--KSLU_CLU_IDENT ident,-->
                        <!--KSLU_CLU_RSLT res,-->
                        <!--KSLU_CLURES_JN_RESOPT jn,-->
                        <!--KSLU_RSLT_OPT opt-->
                        <!--WHERE-->
                        <!--clu.offic_clu_id = ident.id-->
                        <!--and-->
                        <!--clu.id = res.clu_id-->
                        <!--AND-->
                        <!--res.id = jn.clu_res_id-->
                        <!--AND-->
                        <!--jn.res_opt_id = opt.id-->
                        <!--AND-->
                        <!--res.TYPE_KEY_ID = 'kuali.resultType.creditCourseResult'-->
                        <!--AND-->
                        <!--clu.id = :courseID-->
                    <!--</value>-->
                <!--</entry>-->

                <entry key="ksap.course.info">
                    <value>NATIVE:
                        SELECT
                        clu.id,
                        ident.LNG_NAME,
                        trim( ident.SUFX_CD ),
                        trim( ident.DIVISION ),
                        trim( ident.LVL ),
                        opt.RES_COMP_ID,
                        ident.cd
                        FROM
                        KSLU_CLU clu,
                        KSLU_CLU_IDENT ident,
                        KSLU_CLU_RSLT res,
                        KSLU_CLURES_JN_RESOPT jn,
                        KSLU_RSLT_OPT opt
                        WHERE
                        clu.offic_clu_id = ident.id
                        and
                        clu.id = res.clu_id
                        AND
                        res.id = jn.clu_res_id
                        AND
                        jn.res_opt_id = opt.id
                        AND
                        res.TYPE_KEY_ID = 'kuali.resultType.creditCourseResult'
                        AND
                        clu.id IN :courseIDs
                    </value>
                </entry>

                <entry key="ksap.course.info.atp">
                    <value>NATIVE:
                        SELECT
                        clu_id,
                        ATP_TYPE_KEY
                        FROM KSLU_CLU_ATP_TYPE_KEY
                        WHERE
                        clu_id IN :courseIDs
                    </value>
                </entry>

                <entry key="ksap.course.info.gened">
                    <value>NATIVE:
                        SELECT
                        OWNER,
                        ATTR_NAME
                        FROM KSLU_CLU_ATTR
                        WHERE
                        owner IN :courseIDs
                        AND
                        ATTR_VALUE = 'Y'
                        AND
                        ATTR_NAME like 'course.genEdRequirement.%'
                    </value>
                </entry>

                <!--<entry key="ksap.course.info.credits.details">-->
                    <!--<value>NATIVE:-->
                        <!--SELECT-->
                        <!--max( v.result_scale_id ),-->
                        <!--max( c.result_scale_type ),-->
                        <!--min( to_number( v.result_value )),-->
                        <!--max( to_number( v.result_value ))-->
                        <!--from-->
                        <!--ksen_lrc_result_value v,-->
                        <!--ksen_lrc_result_scale c-->
                        <!--where-->
                        <!--c.id = v.result_scale_id-->
                        <!--and-->
                        <!--c.result_scale_type = 'kuali.result.scale.type.credit'-->
                        <!--group by-->
                        <!--v.result_scale_id-->
                    <!--</value>-->
                <!--</entry>-->
                <entry key="ksap.course.info.credits.details">
                    <value>NATIVE:
                        SELECT
                        rvg.ID,
                        rvg.RVG_TYPE,
                        rvg.RANGE_MIN_VALUE ,
                        rvg.RANGE_MAX_VALUE
                        FROM KSEN_LRC_RVG rvg
                        WHERE
                        rvg.RESULT_SCALE_ID like 'kuali.result.scale.credit.%'
                        ORDER BY rvg.ID
                    </value>
                </entry>

                <entry key="ksap.course.prereqsearch.subject">
                    <value>NATIVE:
                        SELECT
                        clu.id
                        FROM
                        KSLU_CLU clu,
                        KSLU_CLU_IDENT id
                        WHERE
                        clu.offic_clu_id = id.id
                        AND
                        trim( id.division ) = :subject
                        ORDER BY id.sufx_cd
                    </value>
                </entry>

                <entry key="ksap.course.prereqsearch.range">
                    <value>NATIVE:
                        SELECT
                        clu.id
                        FROM
                        KSLU_CLU clu,
                        KSLU_CLU_IDENT id
                        WHERE
                        clu.offic_clu_id = id.id
                        AND
                        trim( id.division ) = :subject
                        AND
                        trim( id.lvl ) like :range
                        ORDER BY id.sufx_cd
                    </value>
                </entry>

                <entry key="ksap.course.prereqsearch.exclusions">
                    <value>NATIVE:
                        SELECT
                        clu.id,
                        id.sufx_cd
                        FROM
                        KSLU_CLU clu,
                        KSLU_CLU_IDENT id
                        WHERE
                        clu.offic_clu_id = id.id
                        AND
                        trim( id.division ) like :subject
                        AND
                        trim( id.sufx_cd ) like :range
                        ORDER BY
                        id.sufx_cd
                    </value>
                </entry>
                <entry key="ksap.course.getcluid">
                    <value>NATIVE:
                        SELECT
                        clu.id, id.LNG_NAME
                        FROM
                        KSLU_CLU clu,
                        KSLU_CLU_IDENT id
                        WHERE
                        clu.offic_clu_id = id.id
                        AND
                        trim( id.SUFX_CD ) = :number
                        AND
                        trim( id.DIVISION ) = :subject
                        AND clu.EXP_FIRST_ATP = (select min(c.EXP_FIRST_ATP) FROM KSLU_CLU c where c.ver_ind_id = clu.ver_ind_id group by c.ver_ind_id )
                    </value>
                </entry>
                <entry key="ksap.course.getCourseTitleAndId">
                    <value>NATIVE:
                        SELECT
                        clu.id, id.LNG_NAME
                        FROM
                        KSLU_CLU clu,
                        KSLU_CLU_IDENT id
                        WHERE
                        clu.offic_clu_id = id.id
                        AND
                        trim( id.SUFX_CD ) = :number
                        AND
                        trim( id.DIVISION ) = :subject
                        AND clu.EXP_FIRST_ATP = (select min(c.EXP_FIRST_ATP) FROM KSLU_CLU c where c.ver_ind_id = clu.ver_ind_id and c.LAST_ATP &gt;= :ksap.lu.search.title group by c.ver_ind_id )
                    </value>
                </entry>

                <!--<entry key="ksap.course.getCampusLocations">-->
                    <!--<value>-->
                        <!--SELECT-->
                        <!--attr.value-->
                        <!--FROM CluAttribute attr-->
                        <!--JOIN attr.owner clu-->
                        <!--JOIN clu.officialIdentifier ident-->
                        <!--WHERE-->
                        <!--clu.id = :cluId-->
                        <!--AND-->
                        <!--attr.name = 'course.campus'-->
                        <!--AND-->
                        <!--clu.id NOT IN (SELECT att.owner FROM CluAttribute att where att.name='course.catalogOmit_ind'-->
                        <!--and att.value='Y')-->
                        <!--AND clu.expectedFirstAtp = (select min(c.expectedFirstAtp) FROM Clu c where c.version.versionIndId = clu.version.versionIndId and c.lastAtp &gt;= :lastScheduledTerm group by c.version.versionIndId )-->
                        <!--ORDER BY ident.suffixCode-->
                    <!--</value>-->
                <!--</entry>-->

                <!--Quick search queries-->
                <entry key="ksap.clu.division">
                    <value>
                        SELECT
                        ident.code
                        FROM CluAttribute attr
                        JOIN attr.owner clu
                        JOIN clu.officialIdentifier ident
                        WHERE
                        ident.division LIKE :division||'%'
                        <!--AND-->
                        <!--attr.name = 'course.campus'-->
                        AND clu.id NOT IN (SELECT att.owner FROM CluAttribute att where
                        att.name='course.catalogOmit_ind' and att.value='Y')
                        AND clu.expectedFirstAtp = (select min(c.expectedFirstAtp) FROM Clu c where c.version.versionIndId = clu.version.versionIndId and c.lastAtp &lt;= :lastScheduledTerm group by c.version.versionIndId )
                        ORDER BY ident.division, ident.suffixCode
                    </value>
                </entry>

                <entry key="ksap.clu.divisionAndCode">
                    <value>
                        SELECT
                        ident.code
                        FROM CluAttribute attr
                        JOIN attr.owner clu
                        JOIN clu.officialIdentifier ident
                        WHERE
                        ident.division LIKE :division||'%'
                        AND
                        ident.suffixCode LIKE :code||'%'
                        <!--AND-->
                        <!--attr.name = 'course.campus'-->
                        AND clu.id NOT IN (SELECT att.owner FROM CluAttribute att where
                        att.name='course.catalogOmit_ind' and att.value='Y')
                        AND clu.expectedFirstAtp = (select min(c.expectedFirstAtp) FROM Clu c where c.version.versionIndId = clu.version.versionIndId and c.lastAtp &lt;= :lastScheduledTerm group by c.version.versionIndId )
                        ORDER BY ident.division, ident.suffixCode
                    </value>
                </entry>
                <entry key="ksap.course.version.id">
                    <value>NATIVE:
                        SELECT clu.ID
                        FROM KSLU_CLU clu
                        WHERE clu.id = :courseId OR (clu.ver_ind_id = :courseId) AND clu.EXP_FIRST_ATP = (select min(c.EXP_FIRST_ATP)
                        FROM KSLU_CLU c where c.ver_ind_id = clu.ver_ind_id and c.LAST_ATP >= :lastScheduledTerm group by c.ver_ind_id )
                    </value>
                </entry>

            </map>
        </property>
    </bean>
</beans>